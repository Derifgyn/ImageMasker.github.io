var height,width,baseImage=null,maskImage=null,finalImage=null,mask=null,canvas=new fabric.Canvas("canvas");function addProxyToUrl(e){return url="https://cors-anywhere.herokuapp.com/"+e.replace(/(^\w+:|^)\/\//,"")}function checkURL(e){null!=e.match(/\.(jpeg|jpg|gif|png)$/)&&(loadSourceImage())}function loadSourceImage(){baseUrl=document.getElementById("original").value,""==baseUrl?sourceImageUrl="images/placeholder.png":sourceImageUrl=addProxyToUrl(document.getElementById("original").value),fabric.util.loadImage(sourceImageUrl,function(e){baseImage=e,height=e.height,width=e.width,canvas.setHeight(height).setWidth(width),canvas.setBackgroundImage(new fabric.Image(e),canvas.renderAll.bind(canvas),{width:width,height:height,originX:0,originY:0})},null,"Anonymous")}function uploadMaskImage(e){var a=e.target.files[0].type,t=URL.createObjectURL(e.target.files[0]);alpha=document.getElementById("alpha").value/100,"image/png"===a&&(finalImage&&canvas.remove(finalImage),fabric.Image.fromURL(t,function(e){e.set({cornerSize:15,borderColor:"white",cornerColor:"white",transparentCorners:!1,hasRotatingPoint:!1,opacity:alpha}),finalImage=e,canvas.add(finalImage)}),document.getElementById("uploadbutton").style.display="inline-block",document.getElementById("uploadbutton").value="Upload to Imgur",document.getElementById("uploadbutton").disabled=!1,document.getElementById("uploadedUrl").style.display="none",document.getElementById("copyToClipboard").style.display="none",document.getElementById("checkForRIS").style.display="none")}function loadMaskImage(e){alpha=document.getElementById("alpha").value/100,maskImageUrl=e.src,fabric.util.loadImage(maskImageUrl,function(e){maskImage=e,finalImage&&canvas.remove(finalImage),(finalImage=new fabric.Image(maskImage).set({cornerSize:15,borderColor:"white",cornerColor:"white",transparentCorners:!1,hasRotatingPoint:!1})).set("opacity",alpha),canvas.add(finalImage)},null,"Anonymous"),document.getElementById("uploadbutton").style.display="inline-block",document.getElementById("uploadbutton").value="Upload to Imgur",document.getElementById("uploadbutton").disabled=!1,document.getElementById("uploadedUrl").style.display="none",document.getElementById("copyToClipboard").style.display="none",document.getElementById("checkForRIS").style.display="none"}function upload(){var e=document.getElementById("canvas").toDataURL("image/png").split(",")[1];$.ajax({url:"https://api.imgur.com/3/image",type:"post",headers:{Authorization:"Client-ID 9c586fafe6ec100"},data:{image:e},dataType:"json",success:function(e){e.success?(document.getElementById("uploadedUrl").value=e.data.link,document.getElementById("uploadbutton").style.display="none",document.getElementById("uploadedUrl").style.display="inline-block",document.getElementById("copyToClipboard").style.display="inline-block",document.getElementById("checkForRIS").style.display="inline-block"):document.getElementById("uploadedUrl").value="Failed to upload"}}),document.getElementById("uploadbutton").value="Uploading...",document.getElementById("uploadbutton").disabled=!0}function copyUrl(){document.getElementById("uploadedUrl").select(),document.execCommand("Copy")}function checkRIS(){var e=document.getElementById("uploadedUrl").value;window.open("http://www.google.com/searchbyimage?image_url="+e),window.open("https://www.bing.com/images/searchbyimage?cbir=ssbi&pageurl=http%3A%2F%2Fwww.squobble.com&imgurl="+e),window.open("https://www.yandex.com/images/search?rpt=imageview&img_url="+e),window.open("http://www.tineye.com/search/?url="+e)}loadSourceImage();