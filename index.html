    <!DOCTYPE html>
<html>
  <head>
    <meta charset='UTF-8'>
    <link rel="stylesheet" href="stylesheet.css">
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <title> Image Masker </title>
  </head>
  <body>
    <h1> Image Masker </h1>
    <div id="container">
      <div class="tools">
        <p> 
          Source Image URL:
          <input type='text' placeholder='Your Image' id='original' size=20 onblur="loadSourceImage()" value=""/>
        </p>
        <p>
          Enter Opacity (0-100):
          <input type='text' id='alpha' value=100>
        </p>
      <p>
        Pick a mask to use.
      </p>
      <img width='125' height='125' src='images/1.png' onclick='loadMaskImage(this)' />
      <img width='125' height='125' src='images/2.png' onclick='loadMaskImage(this)' />
      <img width='125' height='125' src='images/3.png' onclick='loadMaskImage(this)' />
      <img width='125' height='125' src='images/4.png' onclick='loadMaskImage(this)' />
      <div class="maskUpload">
        <label for="uploadMask">
          <img width='125' height='125' src='images/upload.png'/>
        </label>
        <input type="file" id="uploadMask" style="display: none;" onchange="uploadMaskImage(event)">
      </div>
      </div>
      <div class="preview">
        <div class="buttons">
          <input type="button" id="uploadbutton" onclick="upload()" value="Upload to Imgur" style="display: none;"/>
          <input type="text" id="uploadedUrl"  style="display: none;">
          <button type="button" id="copyToClipboard" onclick="copyUrl()" style="display: none;">Copy</button>
          <button type="button" id="checkForRIS" onclick="checkRIS()" style="display: none;">Check RIS</button>
        </div>
        <canvas id='canvas'></canvas>
      </div>
    </div>
  <script type="text/javascript" src="js/fabric.min.js"></script>
  <script>
    var baseImage = null;
    var maskImage = null;
    var finalImage = null;
    var height, width;
    var mask = null;
    var canvas = new fabric.Canvas("canvas");
    
    function addProxyToUrl(baseUrl) {
      return url = "https://cors-anywhere.herokuapp.com/" + baseUrl.replace(/(^\w+:|^)\/\//, '');
    }

    function loadSourceImage() {
        baseUrl = document.getElementById('original').value;
        if (baseUrl == "") {
            sourceImageUrl = "images/placeholder.png"
        } else {
            sourceImageUrl = addProxyToUrl(document.getElementById('original').value);
        }
        fabric.util.loadImage(sourceImageUrl, function(_baseImage) {
            baseImage = _baseImage;
            height = _baseImage.height;
            width = _baseImage.width;
            canvas.setHeight(height).setWidth(width);
            canvas.setBackgroundImage(new fabric.Image(_baseImage), canvas.renderAll.bind(canvas), {
                width: width,
                height: height,
                originX: 0,
                originY: 0
            });
        }, null, "Anonymous");
    }
    loadSourceImage();

    function uploadMaskImage(e) {
      var filetype = e.target.files[0].type;
      var url = URL.createObjectURL(e.target.files[0]);
      alpha = document.getElementById('alpha').value / 100;

      if (filetype === "image/png") {
        if (finalImage) {
          canvas.remove(finalImage);
        }
        fabric.Image.fromURL(url, function(img) {
          img.set({
            cornerSize: 15,
            borderColor: "white",
            cornerColor: "white",
            transparentCorners: false,
            hasRotatingPoint: false,
            opacity: alpha
          });
          finalImage = img;
          canvas.add(finalImage);
        });
        document.getElementById('uploadbutton').style.display = "inline-block";
        document.getElementById('uploadbutton').value = "Upload to Imgur";
        document.getElementById('uploadbutton').disabled = false;
        document.getElementById('uploadedUrl').style.display = "none";
        document.getElementById('copyToClipboard').style.display = "none";
        document.getElementById('checkForRIS').style.display = "none";
    }
  }

    function loadMaskImage(selectedMask) {
        alpha = document.getElementById('alpha').value / 100;
        maskImageUrl = selectedMask.src;
        fabric.util.loadImage(maskImageUrl, function(_maskImage) {
            maskImage = _maskImage;
            if (finalImage) {
                canvas.remove(finalImage);
            }
            finalImage = new fabric.Image(maskImage).set({
              cornerSize: 15,
              borderColor: "white",
              cornerColor: "white",
              transparentCorners: false,
              hasRotatingPoint: false
            });
            finalImage.set('opacity', alpha);
            canvas.add(finalImage);
        }, null, "Anonymous");
        document.getElementById('uploadbutton').style.display = "inline-block";
        document.getElementById('uploadbutton').value = "Upload to Imgur";
        document.getElementById('uploadbutton').disabled = false;
        document.getElementById('uploadedUrl').style.display = "none";
        document.getElementById('copyToClipboard').style.display = "none";
        document.getElementById('checkForRIS').style.display = "none";
    }

    function upload() {
      var img = document.getElementById('canvas').toDataURL('image/png').split(',')[1];

      $.ajax({
          url: 'https://api.imgur.com/3/image',
          type: 'post',
          headers: {
              Authorization: 'Client-ID 9c586fafe6ec100'
          },
          data: {
              image: img
          },
          dataType: 'json',
          success: function(response) {
              if(response.success) {
                  document.getElementById('uploadedUrl').value = response.data.link;
                  document.getElementById('uploadbutton').style.display = "none";
                  document.getElementById('uploadedUrl').style.display = "inline-block";
                  document.getElementById('copyToClipboard').style.display = "inline-block";
                  document.getElementById('checkForRIS').style.display = "inline-block";
              } else {
                document.getElementById('uploadedUrl').value = "Failed to upload";
              }
          }
      });
    document.getElementById('uploadbutton').value = "Uploading...";
    document.getElementById('uploadbutton').disabled = true;
    }

    function copyUrl() {
      var copyText = document.getElementById("uploadedUrl");
      copyText.select();
      document.execCommand("Copy");
    }

    function checkRIS() {
      var url = document.getElementById("uploadedUrl").value;
      window.open("http://www.google.com/searchbyimage?image_url="+url);
      window.open("https://www.bing.com/images/searchbyimage?cbir=ssbi&pageurl=http%3A%2F%2Fwww.squobble.com&imgurl="+url);
      window.open("https://www.yandex.com/images/search?rpt=imageview&img_url="+url);
      window.open("http://www.tineye.com/search/?url="+url);
    }
</script>
  </body>
</html>